<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ TerraFlow Project Launcher</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white;
            min-height: 100vh;
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.1); 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .header h1 {
            font-size: 3rem;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin: 10px 0;
        }
        .launch-section {
            background: rgba(255,255,255,0.15);
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .launch-section h2 {
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .step-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .step {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .step h3 {
            margin-top: 0;
            color: #ffd700;
        }
        button {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        button:hover {
            background: linear-gradient(45deg, #218838, #1c9a80);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        .danger { background: linear-gradient(45deg, #dc3545, #c82333) !important; }
        .danger:hover { background: linear-gradient(45deg, #c82333, #a71e2a) !important; }
        .warning { background: linear-gradient(45deg, #ffc107, #e0a800) !important; color: #000 !important; }
        .warning:hover { background: linear-gradient(45deg, #e0a800, #d39e00) !important; }
        .status { 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 8px; 
            border-left: 4px solid;
        }
        .success { 
            background: rgba(40, 167, 69, 0.2); 
            border-color: #28a745; 
            color: #d4edda; 
        }
        .error { 
            background: rgba(220, 53, 69, 0.2); 
            border-color: #dc3545; 
            color: #f8d7da; 
        }
        .info { 
            background: rgba(23, 162, 184, 0.2); 
            border-color: #17a2b8; 
            color: #d1ecf1; 
        }
        .warning-status { 
            background: rgba(255, 193, 7, 0.2); 
            border-color: #ffc107; 
            color: #fff3cd; 
        }
        pre { 
            background: rgba(0,0,0,0.3); 
            padding: 15px; 
            border-radius: 6px; 
            overflow-x: auto; 
            color: #f8f9fa;
        }
        .quick-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .running { background: #28a745; }
        .stopped { background: #dc3545; }
        .unknown { background: #6c757d; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ TerraFlow SCM</h1>
            <p>Supply Chain Management System</p>
            <p>Complete Project Launcher & Admin Profile Access</p>
        </div>

        <!-- System Status -->
        <div class="launch-section">
            <h2>ğŸ“Š System Status</h2>
            <div id="system-status">Checking system status...</div>
            <div style="margin-top: 15px;">
                <button onclick="checkSystemStatus()">ğŸ”„ Refresh Status</button>
                <button onclick="openTaskManager()" class="warning">ğŸ“‹ Task Manager</button>
            </div>
        </div>

        <!-- Quick Launch -->
        <div class="launch-section">
            <h2>ğŸš€ Quick Launch</h2>
            <div class="step-container">
                <div class="step">
                    <h3>1ï¸âƒ£ Start Backend</h3>
                    <p>Node.js server on port 5000</p>
                    <button onclick="startBackend()">â–¶ï¸ Start Backend</button>
                    <button onclick="stopBackend()" class="danger">â¹ï¸ Stop Backend</button>
                </div>
                <div class="step">
                    <h3>2ï¸âƒ£ Start Frontend</h3>
                    <p>React app on port 5173</p>
                    <button onclick="startFrontend()">â–¶ï¸ Start Frontend</button>
                    <button onclick="stopFrontend()" class="danger">â¹ï¸ Stop Frontend</button>
                </div>
                <div class="step">
                    <h3>3ï¸âƒ£ Admin Access</h3>
                    <p>Login and access admin profile</p>
                    <button onclick="setupAdminAccess()">ğŸ” Setup Admin Access</button>
                    <button onclick="openAdminProfile()">ğŸ‘¤ Open Admin Profile</button>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="fullLaunch()" style="font-size: 18px; padding: 15px 30px;">ğŸš€ FULL LAUNCH</button>
            </div>
        </div>

        <!-- Admin Profile Access -->
        <div class="launch-section">
            <h2>ğŸ‘¤ Admin Profile Management</h2>
            <div id="admin-status">Checking admin session...</div>
            <div class="quick-links">
                <button onclick="testAdminLogin()">ğŸ”‘ Test Admin Login</button>
                <button onclick="openDirectProfile()">ğŸ‘¤ Direct Profile Access</button>
                <button onclick="openLoginPage()">ğŸŒ Open Login Page</button>
                <button onclick="clearSession()" class="danger">ğŸ—‘ï¸ Clear Session</button>
            </div>
        </div>

        <!-- Quick Links -->
        <div class="launch-section">
            <h2>ğŸ”— Quick Access Links</h2>
            <div class="quick-links">
                <button onclick="openUrl('http://localhost:5173')">ğŸŒ Frontend Home</button>
                <button onclick="openUrl('http://localhost:5173/login')">ğŸ” Login Page</button>
                <button onclick="openUrl('http://localhost:5173/admin')">ğŸ‘‘ Admin Dashboard</button>
                <button onclick="openUrl('http://localhost:5173/admin/profile')">ğŸ‘¤ Admin Profile</button>
                <button onclick="openUrl('http://localhost:5000')">âš™ï¸ Backend API</button>
            </div>
        </div>

        <!-- Results -->
        <div class="launch-section">
            <h2>ğŸ“‹ Activity Log</h2>
            <div id="results"></div>
        </div>
    </div>

    <script>
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        async function checkSystemStatus() {
            addResult('ğŸ” Checking system status...', 'info');
            
            try {
                // Check frontend
                const frontendPromise = fetch('http://localhost:5173').then(r => ({ status: 'running', port: 5173 })).catch(() => ({ status: 'stopped', port: 5173 }));
                // Check backend
                const backendPromise = fetch('http://localhost:5000').then(r => ({ status: 'running', port: 5000 })).catch(() => ({ status: 'stopped', port: 5000 }));
                
                const [frontend, backend] = await Promise.all([frontendPromise, backendPromise]);
                
                let statusHtml = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">';
                
                statusHtml += `<div class="status ${frontend.status === 'running' ? 'success' : 'error'}">
                    <span class="status-indicator ${frontend.status}"></span>
                    <strong>Frontend (Port 5173)</strong><br>
                    Status: ${frontend.status === 'running' ? 'âœ… Running' : 'âŒ Stopped'}
                </div>`;
                
                statusHtml += `<div class="status ${backend.status === 'running' ? 'success' : 'error'}">
                    <span class="status-indicator ${backend.status}"></span>
                    <strong>Backend (Port 5000)</strong><br>
                    Status: ${backend.status === 'running' ? 'âœ… Running' : 'âŒ Stopped'}
                </div>`;
                
                statusHtml += '</div>';
                
                document.getElementById('system-status').innerHTML = statusHtml;
                
                if (frontend.status === 'running' && backend.status === 'running') {
                    addResult('âœ… Both frontend and backend are running!', 'success');
                } else {
                    addResult('âš ï¸ Some services are not running. Use the launch buttons to start them.', 'warning-status');
                }
                
            } catch (error) {
                addResult('âŒ Error checking system status: ' + error.message, 'error');
            }
        }

        function startBackend() {
            addResult('ğŸš€ Starting backend server...', 'info');
            addResult('â„¹ï¸ Please run: cd TerraflowBackend && npm start', 'info');
            addResult('ğŸ”— Or click the batch file: START_TERRAFLOW.bat', 'info');
        }

        function startFrontend() {
            addResult('ğŸš€ Starting frontend server...', 'info');
            addResult('â„¹ï¸ Please run: cd frontend && npm run dev', 'info');
        }

        function stopBackend() {
            addResult('â¹ï¸ To stop backend, close the terminal running the backend server', 'warning-status');
        }

        function stopFrontend() {
            addResult('â¹ï¸ To stop frontend, close the terminal running the frontend server', 'warning-status');
        }

        async function setupAdminAccess() {
            addResult('ğŸ” Setting up admin access...', 'info');
            
            try {
                // Login as admin
                const response = await fetch('http://localhost:5000/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'admin@terraflow.com',
                        password: 'admin123'
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Backend not responding. Please start the backend first.');
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // Store session data
                    const user = {
                        id: data.user.id.toString(),
                        username: data.user.full_name,
                        email: data.user.email,
                        role: data.user.role,
                        fullName: data.user.full_name,
                        isApproved: true,
                        token: data.token
                    };
                    
                    localStorage.setItem('terraflow_user', JSON.stringify(user));
                    localStorage.setItem('terraflow_token', data.token);
                    
                    addResult('âœ… Admin session created successfully!', 'success');
                    addResult(`ğŸ‘¤ Logged in as: ${user.fullName} (${user.role})`, 'info');
                    checkAdminSession();
                } else {
                    addResult('âŒ Admin login failed: ' + data.message, 'error');
                }
                
            } catch (error) {
                addResult('âŒ Failed to setup admin access: ' + error.message, 'error');
                addResult('ğŸ’¡ Make sure the backend server is running on port 5000', 'info');
            }
        }

        function checkAdminSession() {
            const user = localStorage.getItem('terraflow_user');
            const token = localStorage.getItem('terraflow_token');
            
            let statusHtml = '';
            
            if (user && token) {
                const userData = JSON.parse(user);
                statusHtml = `
                    <div class="status success">
                        <strong>âœ… Admin Session Active</strong><br>
                        ğŸ‘¤ Name: ${userData.fullName}<br>
                        ğŸ“§ Email: ${userData.email}<br>
                        ğŸ‘‘ Role: ${userData.role}<br>
                        ğŸ« Token: ${token.substring(0, 20)}...
                    </div>
                `;
            } else {
                statusHtml = `
                    <div class="status warning-status">
                        âš ï¸ No admin session found. Please setup admin access first.
                    </div>
                `;
            }
            
            document.getElementById('admin-status').innerHTML = statusHtml;
        }

        function openAdminProfile() {
            const user = localStorage.getItem('terraflow_user');
            
            if (!user) {
                addResult('âŒ No admin session found. Please setup admin access first.', 'error');
                return;
            }
            
            addResult('ğŸš€ Opening admin profile...', 'info');
            openUrl('http://localhost:5173/admin/profile');
        }

        function openDirectProfile() {
            addResult('ğŸŒ Opening admin profile directly...', 'info');
            openUrl('http://localhost:5173/admin/profile');
        }

        function openLoginPage() {
            addResult('ğŸŒ Opening login page...', 'info');
            openUrl('http://localhost:5173/login');
        }

        function testAdminLogin() {
            addResult('ğŸ§ª Testing admin credentials...', 'info');
            setupAdminAccess();
        }

        function clearSession() {
            localStorage.removeItem('terraflow_user');
            localStorage.removeItem('terraflow_token');
            addResult('ğŸ—‘ï¸ Admin session cleared', 'warning-status');
            checkAdminSession();
        }

        function openUrl(url) {
            window.open(url, '_blank');
            addResult(`ğŸ”— Opened: ${url}`, 'info');
        }

        function openTaskManager() {
            addResult('ğŸ“‹ Task Manager functionality would open system task manager', 'info');
        }

        async function fullLaunch() {
            addResult('ğŸš€ Starting full launch sequence...', 'info');
            
            // Step 1: Check system status
            await checkSystemStatus();
            
            // Step 2: Setup admin access
            setTimeout(async () => {
                await setupAdminAccess();
                
                // Step 3: Open admin profile
                setTimeout(() => {
                    openAdminProfile();
                    addResult('ğŸ‰ Full launch completed!', 'success');
                }, 2000);
            }, 1000);
        }

        // Initialize
        window.onload = function() {
            addResult('ğŸŒŸ TerraFlow Project Launcher initialized', 'success');
            checkSystemStatus();
            checkAdminSession();
        };
    </script>
</body>
</html>
